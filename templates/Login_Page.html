<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPC Library - Login/Signup</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }

        .header {
            background-color: #45a049;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            color: white;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .header a {
            color: #f2f2f2;
            text-decoration: none;
            padding: 14px 20px;
        }

        .header a:hover {
            color: black;
        }

        .container {
            margin: 50px auto;
            width: 400px;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #45a049;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
            color: #666;
        }

        .tab.active {
            color: #45a049;
            border-bottom: 2px solid #45a049;
            margin-bottom: -2px;
        }

        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
        }

        input[type="text"],
        input[type="email"],
        select {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #45a049;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #338040;
        }

        .radio-group {
            margin: 10px 0;
        }

        .success-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .success-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .blur-background {
            filter: blur(5px);
        }
        
    </style>
</head>
<body>
    <section class="header">
        <div class="header-left">
            <img src="{{ url_for('static', filename='images/SPC_lib.png') }}" alt="SPC Logo" class="header-logo">
            <a href="/">San Pablo Colleges Library</a>
            <a href="/login_page">Login</a>
        </div>
        <div class="navbar"> 
            <a href="/info">Information</a>
            <a href="/announcement">Announcement</a>
            <a href="/librarian">Librarian</a>
        </div>
    </section>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('login')">Login</button>
            <button class="tab" onclick="switchTab('signup')">Sign Up</button>
        </div>

        <!-- Login Form -->
    <div id="loginForm" class="form-container active">
        <h2>Login</h2>
        <form method="POST" action="/login_page" onsubmit="return validateLoginForm(event)">
            <label for="login_ID_Number">ID Number:</label>
            <input type="text" 
                   id="login_ID_Number" 
                   name="ID_Number" 
                   pattern="[0-9]{7}" 
                   maxlength="7" 
                   required 
                   oninput="validateLoginInput(this)">
            <div id="login-error-message" class="error-message">
                Please enter a valid 7-digit ID number
            </div>
            <button type="submit">Login</button>
        </form>
        <p>Use your barcode scanner to scan your ID or manually enter your ID Number.</p>
    </div>

        <!-- Signup Form -->
        <div id="signupForm" class="form-container">
            <h2>Sign Up</h2>
            <form action="/signup_page_student" method="POST" onsubmit="return handleSubmit(event)" enctype="multipart/form-data">
                <label for="ID_Number">ID Number:</label>
                <input type="text" 
                    id="ID_Number" 
                    name="ID_Number" 
                    pattern="[0-9]{7}" 
                    maxlength="7" 
                    required 
                    oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                    placeholder="Enter 7-digit ID number">

                <label for="Name">Name:</label>
                <input type="text" id="Name" name="Name" required>

                <label for="Department">Department:</label>
                <select id="Department" name="Department" onchange="updateLevelOptions()" required>
                    <option value="">Select Department</option>
                    <option value="Elementary">Elementary</option>
                    <option value="High School">High School</option>
                    <option value="Senior High School">Senior High School</option>
                    <option value="College">College</option>
                </select>

                <label for="Level">Level:</label>
                <select id="Level" name="Level" required>
                    <option value="">Select Level</option>
                </select>

                <label for="Course_Strand">Course/Strand:</label>
                <input type="text" id="Course_Strand" name="Course_Strand" required>

                <label for="Email">Email:</label>
                <input type="email" id="Email" name="Email" required>

                <div class="radio-group">
                    <label>Gender:</label>
                    <input type="radio" id="Male" name="Gender" value="M" required>
                    <label for="Male">Male</label>
                    <input type="radio" id="Female" name="Gender" value="F" required>
                    <label for="Female">Female</label>
                </div>

                <button type="submit">Submit</button>
            </form>
        </div>
    </div>

    <script>
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update form containers
            document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
            if (tab === 'login') {
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.getElementById('signupForm').classList.add('active');
            }
        }

        function updateLevelOptions() {
            const department = document.getElementById('Department').value;
            const level = document.getElementById('Level');
            level.innerHTML = '<option value="">Select Level</option>';

            const options = {
                'Elementary': ['Grade 1', 'Grade 2', 'Grade 3', 'Grade 4', 'Grade 5', 'Grade 6'],
                'High School': ['Grade 7', 'Grade 8', 'Grade 9', 'Grade 10'],
                'Senior High School': ['Grade 11', 'Grade 12'],
                'College': ['1st Year', '2nd Year', '3rd Year', '4th Year']
            };

            if (options[department]) {
                options[department].forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.innerHTML = option;
                    level.appendChild(opt);
                });
            }
        }

        function validateIdNumber() {
            const idNumber = document.getElementById('ID_Number');
            const value = idNumber.value;
            
            if (value.length !== 7) {
                idNumber.setCustomValidity('ID number must be exactly 7 digits');
                return false;
            } else if (!/^\d+$/.test(value)) {
                idNumber.setCustomValidity('ID number must contain only digits');
                return false;
            } else {
                idNumber.setCustomValidity('');
                return true;
            }
        }

        function handleSubmit(event) {
            event.preventDefault();
            
            if (!validateIdNumber()) {
                return false;
            }

            const form = event.target;
            const formData = new FormData(form);

            fetch('/signup_page_student', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    showSuccessDialog();
                } else {
                    alert('Error submitting form. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error submitting form. Please try again.');
            });

            return false;
        }

        function showSuccessDialog() {
            const existingDialog = document.getElementById('successDialog');
            if (existingDialog) {
                existingDialog.remove();
            }

            const container = document.querySelector('.container');
            container.classList.add('blur-background');

            const dialogHTML = `
                <div id="successDialog" class="success-dialog">
                    <div class="success-content">
                        <h2>User Created Successfully!</h2>
                        <div class="success-buttons">
                            <button onclick="createAnotherUser()">Create Another User</button>
                            <button onclick="backToHome()">Back to Home</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', dialogHTML);
        }

        function createAnotherUser() {
            document.getElementById('successDialog').remove();
            document.querySelector('.container').classList.remove('blur-background');
            document.querySelector('#signupForm form').reset();
            document.getElementById('Level').innerHTML = '<option value="">Select Level</option>';
        }

        function backToHome() {
            window.location.href = '/';
        }
        function validateLoginInput(input) {
            const errorMessage = document.getElementById('login-error-message');
            const value = input.value;
            
            // Remove any non-numeric characters
            input.value = value.replace(/[^0-9]/g, '');
            
            if (value.length !== 7 || !/^\d+$/.test(value)) {
                input.classList.add('error');
                errorMessage.style.display = 'block';
                return false;
            } else {
                input.classList.remove('error');
                errorMessage.style.display = 'none';
                return true;
            }
        }

        function validateLoginForm(event) {
            const input = document.getElementById('login_ID_Number');
            if (!validateLoginInput(input)) {
                event.preventDefault();
                return false;
            }
            return true;
        }
    </script>
</body>
</html>